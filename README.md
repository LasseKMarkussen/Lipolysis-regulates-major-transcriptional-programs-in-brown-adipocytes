# Lipolysis-regulates-major-transcriptional-programs-in-brown-adipocytes
Lipolysis regulates major transcriptional programs in brown adipocytes

This is a repository for the Nature Commn. paper "Lipolysis regulates major transcriptional programs in brown adipocytes". Here I have included my codes for alignment, peak calling, R studio analysis etc. 

RNA extraction, cDNA synthesis and quantitative real-time PCR			            
RNA extraction, cDNA synthesis and quantitative real-time PCR (qPCR) were performed as previously described 67. Briefly, total RNA was harvested using TRIzol reagent and isolated using the chloroform-isopropanol method. cDNA was transcribed using the QuantiTect Reverse Transcription Kit (Qiagen, #205311). qPCR was conducted using FastStart Essential DNA Green Master Mix (Roche, #06924204001) and the reaction was performed using LightCycler 480 Instrument II (Roche). Data were normalized to transcript levels of transcription factor II B (Tfiib). All primer sequences can be provided upon request. 

RNA-seq library construction, sequencing and processing		                               
RNA-seq was performed according to the instructions by the manufacturer (TruSeq2, Illumina) using 500ng-1µg of total RNA for preparation of cDNA libraries. Sequencing reads were mapped to the mouse genome mm9 using STAR 68 (v2.4.2a), tag counts were summarized at the gene level using HOMER 69, allowing only one read per position per length. Quantification of the number of mapped reads of each gene was performed using iRNA-seq70 (v1.1) specifying the “-count gene” option. Data analysis was performed in R studio (v2022.2.0) and K-means clustering using 4 clusters was used to cluster differentially expressed genes as determined by DESeq2 71 (v1.24.0). Gene ontology analysis was performed using GO-seq 72, 73 (v1.36.0). RNA-seq data were generated from three independent experiments, except PPAR knockdown RNA-seq which is from two independent experiments. 

ChIP- and ATAC sequencing and analysis				                                
ChIP experiments were performed in brown adipocytes at D7 essentially as previously described 74. The antibody used was H3K27ac (Abcam, #Ab4729). Approximately 10-20 ng of immunoprecipitated DNA was prepared for sequencing according to the instructions from the manufacturer (Illumina). Sequence tags were aligned to the mouse reference genome mm9 using STAR 68, and ChIP peaks were called using idr ENCODE. STAR derived .bam files were used as input for MACS2 at a low threshold. MACS2 peak calling was done on a pooled library of both replicates for each condition. Input DNA was used as background for peak detection. Peaks with an IDR ≤ 0.05 were kept and merged using HOMER (v4.10) mergePeaks function with distance -d given. ChIP-seq data were generated from two independent experiments. ATAC-sequencing (ATAC-seq) was performed on 50,000 nuclei as previously described 34. Library amplification was performed according to the instructions from the manufacturer (Illumina). Sequencing reads were mapped to the mouse genome using STAR 71, and sequencing tags in peaks were quantified using HOMER 69. Only reads with a fragment length of ≤ 100bp were kept for further analyses corresponding to the reads located in nucleosome-free regions. For visualization purposes, the individual tag directories were converted into bedgraphs using HOMER makeUCSC specifying -fragLength 70 and -fsize 20e ATAC-seq data were generated from two independent experiments. For identification of ATAC peaks, peaks were called in each condition with HOMER findPeaks using the following settings: ‘peaks’, -fragLength 70, -style factor, minDist 140, -size 70. Tags were then counted in a 200bp window around the peak centers for each condition. From this, mitochondrial peaks were removed, and high confident peaks were identified as having at least 5 tag per 200bp window for both replicates in at least one of the conditions. 
STAR (ChIP): STAR --genomeLoad LoadAndRemove –genomeDir /data/Genomes/mouse/mm9/star/index101bp/ --runThreadN 8 --readFilesCommand zcat --readFilesIn $FASTQFILE --outSJfilterIntronMaxVsReadN 0 --alignIntronMax 1 --alignSJDBoverhangMin 200 --outFileNamePrefix ${FASTQFILE/.fastq.gz/.star_}
STAT (ATAC): STAR --genomeLoad LoadAndRemove --genomeDir /references/mm9star/index101bp/ --readFilesCommand zcat --runThreadN 16 --readFilesIn $i ${i%_R1_001.fastq.gz}_R2_001.fastq.gz --outSJfilterIntronMaxVsReadN 0 --outFilterMatchNmin 25 --alignIntronMax 1 --alignSJDBoverhangMin 200 --outFileNamePrefix ${i%_R1_001.fastq.gz}
MACS2 (peak calling ChIP): callpeak -t $BAMFILE -c IMPUT.bam -f BAM -g mm –outdir macs2/ -n ${BAMFILE/.bam/.pv-1e-3} -p 1e-3 –to-large

Modeling of motif and prediction of binding sites and target genes (IMAGE)	                                  
IMAGE analysis was performed according to instructions 32. Briefly, sequence information in enhancers (defined by ATAC), in combination with enhancer activity (defined by H3K27ac) and transcriptome data were used in a two-step machine learning algorithm to calculate ‘motif activity’, i.e. the contribution of transcription factor motifs to overall enhancer activity and gene expression under given cellular conditions. IMAGE does not group enhancers but uses machine learning to regress the contribution of a single motif to experimentally determined enhancer activity on the basis of an additive model. Furthermore, IMAGE uses an additive and distance-dependent algorithm to model the contribution of distinct enhancer motifs to experimentally determined gene expression. We have shown that the accuracy of IMAGE exceeds that of other prediction strategies or tool 32. The activity of a particular motif for a given sample represents the average contribution of that motif to the activity of all enhancers (step 1) or the expression of all genes (step 2). Moreover, IMAGE predicts target enhancers and target genes for all motifs on the basis of an estimated error per enhancer and gene when comparing the modeled enhancer activity with and without a particular motif (leave-one-out analysis). 
